В Airflow все хуки создаются в виде подклассов абстрактного класса `BaseHook`.
```python
from airflow.hooks.base_hook import BaseHook

class MovielensHook(BaseHook):
    ...
```

Чтобы приступить к созданию хука, нужно определить метод `__init__`, который указывает, какое подключение использует хук (если это применимо), и любые другие дополнительные аргументы, которые ему могут понадобиться. 
```python
from airflow.hooks.base_hook import BaseHook

class MovielensHook(BaseHook):
    def __init__(self, conn_id):
        super().__init__()
        # сохраняем идентификатор подключения
        self._conn_id = conn_id
```
Параметр `conn_id` сообщает хуку, какое подключение использовать. Ожидается, что большинство хуков Airflow определяют метод `get_conn`, который отвечает за установку соединения с внешней системой. 

Простейшая реализация `get_conn` может выглядеть так
```python
class MovielensHook(BaseHook):
    ...
    def get_conn(self):
        session = requests.Session()
        session.auth = (MOVIELENS_USER, MOVIELENS_PASSWORD)

        schema = MOVIELENS_SCHEMA
        host = MOVIELENS_HOST
        port = MOVIELENS_PORT

        base_url = f"{schema}://{host}:{port}"

        return session, base_url
```

Однако, вместо того чтобы вшивать в код наши учетные данные, мы предпочитаем получать их из хранилища учетных данных Airflow, что безопаснее и проще в управлении. Для этого нам сначала нужно добавить наше соединение в базу метаданных Airflow. Это можно сделать, открыв раздел Admin > Connections с помощью веб-интерфейса Airflow и щелкнув Create, чтобы добавить новое подключение.

У класса `BaseHook` есть удобный метод `get_connection`, который может получать нужные сведения для заданного идентификатора подключения из базы метаданных
```python
config = self.get_connection(self._conn_id)
```

Тогда 
```python
class MovielensHook(BaseHook):
    DEFAULT_HOST = "movielens"
    DEFAULT_SCHEMA = "http"
    DEFAULT_PORT = 5000

    def __init__(self, conn_id):
        super().__init__()
        self._conn_id = conn_id

    def get_conn(self):
        config = self.get_connection(self._conn_id)

        schema = config.schema or self.DEFAULT_SCHEMA
        host = config.host or self.DEFAULT_HOST
        port = config.port or self.DEFAULT_PORT

        base_url = f"{schema}://{host}:{port}"

        session = requests.Session()

        if config.login:
            session.auth = (config.login, config.password)

        return session, base_url
```

==Один из недостатков такой реализации состоит в том, что каждый вызов функции `get_conn` будет приводить к вызову к базе метаданных Airflow, поскольку этой функции необходимо получать учетные данные из базы данных==. Можно избежать этого ограничения, также кешируя `session` и `base_url`.